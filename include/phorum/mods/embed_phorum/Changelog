Changelog:
----------

0.0.21 2007-07-07

    - Remove extraneous </div> from the default embed template, as reported
      by Randy Wilson.

0.0.20 2007-05-31

    - Implemented the 0.0.19 change differently. There was a problem with
      Joomla in combination with this code (thanks to Thomas).

0.0.19 2007-05-02

    - Don't run ob_end_clean() after including a Phorum page, in case
      that page already cleaned the output buffer (the new file storage
      API layer does do this).

0.0.18 2007-04-13

    - Added a embed_phorum_deleteuser() function to the syncuser library.

    - Added a link to the Drupal connector.

0.0.17 2007-03-22

    - Added a very simple stub_example, which shows an embedding 
      connector in its simplest form. This connector will always return
      1 (one) as the logged in user_id, so when running this connector
      on a fresh install, it will have the administrator account logged
      in. 

0.0.16 2007-02-26

    - XHTML 1.1 strict validity fixes.

0.0.15 2006-10-11

    - Added explicit full output buffer flushing to the run_phorum.php
      script, in case the rss or file page is loaded. This way, users who
      output for example an HTML page header before including run_phorum.php,
      can add "ob_start()" to the start of their page script to make 
      RSS and file downloads work. Without this feature, the page's starting
      code would be prepended to the XML or file data, rendering it useless.

0.0.14 2006-02-21

    - Removed a workaround that was created for a problem with the
      anti-leaching check that Phorum performs in file.php, in case
      offsite links to files are forbidden. This workaround could be
      removed due to a fix that was done in the Phorum core.
      To make downloading files work, either use a version of Phorum
      newer than 5.1.8-RC2 or allow offsite links for the time being.

    - Ignore this module when running the Phorum 3 -> 5 upgrading script.

    - Changed the layout of message reading and search results.

0.0.13 2006-02-21

    - Changed the layout of the message reading template a bit for an 
      friendlier picture (especially when using a dark title background
      color, the two line title in reading messages could be a bit
      overwhelming).

    - Did some fixing in the layout of paginators.

    - Made sidemenus XHTML correct and added some style to them.

    - A little change in the way anti-leach detection is implemented
      in attachment file downloading.

0.0.12 2006-02-21

    - Again some MSIE rendering problems fixed.

    - The embedding session id is now removed from the $PHORUM["POST_VARS"].
      This was already done for the $PHORUM["GET_VARS"], to prevent the 
      session id from turning up in forms and URL's (because we trick 
      Phorum into doing the URI authentication scheme, it will try to
      generate URL's with the id in it).

    - Extended the fix_content() method of the base connector, so 
      relative paths in CSS url(...) definitions are now rewritten to 
      the absolute Phorum URL path too.

    - Implemented a new method get_profile_link() to the connector class.
      This method will get a user_id as its argument and it can return the link
      to use when linking to user profiles. This way it's easy to link to the
      master application's profile view instead of Phorum's. If this feature is
      not used, the method can return NULL.

0.0.11 2006-02-17

    - Added a "to top" link to the index, read, list and search pages so 
      users can quickly jump back to the top of the page.

    - Fixed some rendering problems for MSIE.

    - Improved consitency in the templates.

    - New feature in settings.tpl: You can enable the following, to 
      inherit font-family from the master application's CSS.
      {VAR feature_css_master_sets_font-family 0}

    - Added a class phorum-submit to all buttons, so buttons can be
      styled in MSIE too. CSS constructions like input[type=submit] do
      not work in MSIE (v6).
      
    - Applied a style to the buttons, similar to Phorum's default 
      template button style. In the settings.tpl you can easily disable
      this default style for the buttons by changing the feature flag
      {VAR feature_css_master_sets_buttonstyle 0}

    - Fixed a URL rewriting problem in the Mambo connector. This problem
      only showed when letting the user jump back to the thead after
      posting a reply.

    - Dynamic showing/hiding of moderator options is redone. The state
      of the moderator options is now remembered using a cookie.
      So the moderator does not have to enable the moderator options
      on every page anymore, which is good in case there are many
      moderation actions to do. Visually, the moderate options switch
      is now a simple checkbox.

    - The PM folders are now visible when doing changes using the
      "Edit Folders" option, so the user has clear visual feedback of
      the changes that are made.

0.0.10 2006-02-16

    - Fixed a bug in the query parsing in the base connector. Phorum
      pages with numbers in them were not recognized. Phorum does not
      have them in the distribution, but we found this out because
      the addon "newest11.php" did not get loaded. Now, the query 
      parsing code accepts more page names.

    - Made the displaying of moderator options when clicking the
      "Moderator Functions" link a lot faster in the "embed_phorum"
      template. 

    - Fixed some displaying issues in the posting editor files of
      the "embed_phorum" template.

    - Unexpected output from Phorum (output before the first 
      [element] in the header.tpl) is not captured and put in 
      $elements["unexpected_output"]. The connector can decide what
      to do with this output. In the provided connectors, the output
      is printed before the body.

    - The trick with the cookie_image script did not work. The cookie
      was printed outside the template [element]s and the URL to the
      cookie was not generated using phorum_get_url(), so it pointed
      to the real Phorum installation. Next to that, I can only generate
      a URL to a main level Phorum script. Generating a URL to
      mods/embed_phorum/cookie_image.php did not work. So now the 
      cookie image code is pulled in the embed_phorum.php script.
      These changes make the cookie image trick work in embedded Phorum,
      so now the session id is only generated once per session.

    - Fixed an undefined index warning in header.tpl.

    - Fixed a little typo in the embed_phorum template's css.global.tpl.

0.0.9 2006-02-16

    - IMPORTANT: In the 0.0.8 release, the footer.tpl contained 
      a statement to remove all /tmp/tpl-* files. This was done
      to make development easier. If you have the cache directory
      set to /tmp and are running UNIX, this will give a performance
      hit, because all compiled templates are cleaned up after
      each page.

    - Changed the template for the PM system:
      The outgoing folder is now separated a little bit from the 
      incoming folders, in case the user has created custom folders. 
      The folder manager is now split into three separate folders. 
      This way <enter> instead of clicking the submit button will
      work for both the new folder and the rename folder form.

    - Updated the README file to match some of the latest changes.

    - Added an embedded version of the default Phorum template and
      put both currently available templates in a subdir "templates"
      in the package.

0.0.8 2006-02-11

    - Created a completely new templateset, for which the target was to
      make it fit withing small spaces. When embedding Phorum into a 
      site, this might often be the case, so it's good to have an
      adapted template for that. A demo of the template can currently
      be viewed at http://mambo.gitaar.net
      Login with username "phorum" and password "phorum" to see all
      features (including moderation).

    - Added new method fix_content() to the connector class. This method
      can be used to apply last-second fixes to the content, before it
      is send to the connector.

    - Implemented fix_content() in the base class to fix src="..." and
      href="..." occurances that use relative links. It's a rather
      crude fix for now, because it does not look if those strings are
      inside some html tag. If you are using a base href that points
      to the real Phorum install, you do not have to run the fixing code.
      In that case, you can override fix_content() in your connector to
      return NULL.

    - Fixes a variable namespace collision in run_phorum.php (for $page)
      which caused threaded read not to display properly.

    - Added head_data page element to the page handling code in the
      Mambo connector.

    - Handling the email address setting in the control panel is now
      working correctly.

    - Added a get_template() method to the connector so it's now easier to
      set the template to use, by having this method return the (directory)
      name of the template to use. This method can return NULL in case
      Phorum is allowed to decide what template to use.

    - Added loading includes/cache.php in the on-the-fly synchronization
      code of the gitaar.net and Mambo connectors, so user caching can
      be enabled in the Phorum settings.

    - Did a fix in the Phorum core to make the "Edit message" link work.
      If you need this, you can download a snapshot package or a Phorum
      version higher than 5.1.8-RC2. If you can't install a newer
      version, you can probably fix the problem by adding
      global $post_fields;
      to the start of the phorum_process_page() function in run_phorum.php
      (untested, but I'm pretty confident that this will work).

    - If the user is logged in, the module redirects the user to the index
      page when accessing the login or registration page. This is needed
      for example to get out of the login page (only a simple message in
      embedded mode, because Phorum does not handle logins) when a user
      follows path:
      - login into the master application
      - go to a private page, like private messages
      - logout from the master application
      - phorum will now show the login page
      - login into the master application
      - module redirects the user to the index page instead of 
        still displaying the login page


0.0.7 2006-02-09

    - Setting the template to use was put in the wrong method in the
      gitaar.net and the Mambo connectors (hook_common_pre instead of 
      hook_common).

0.0.6 2006-02-08

    - Little fix to prevent the Mambo URL from growing into something like
      http://site.com/index.php/index.php/index.php?queryitems.....

0.0.5 2006-02-08

    - In case the run_phorum.php script is unable to find page elements
      in the page that was produced by Phorum, something went wrong.
      Now, the page that was produced is also displayed, along with the
      error which you get when this happens. This makes it easier to 
      identify the problem.

    - In the connector directory for Mambo, there's now a read-to-install
      zip of the Mambo component.

    - I did some first changes to the templates to make them behave better
      when embedded in limited space.

    - Implemented a fix as proposed by chanh to honour Mambo running
      in a subdirectory on the server.

0.0.4 2006-02-05

    - Removed PHP5 specific OO code from connector base and descendant
      classes.

    - Connector init() method was renamed to hook_common_pre() for clarity.

    - Moved functionality for url rewriting and query parsing to methods in
      the PhorumConnector class, so connectors can handle application
      specific rewriting/parsing in case the functionality in the base
      connector class isn't sufficient.

    - Created a first implementation of a Mambo connector. The connector
      supports user synchronization and Mambo specific URL rewriting.
      Super Administrator users in Mambo will get the "admin" flag set
      for the Phorum account. The passwords for these admin users are
      also transferred to Phorum. After a Super Administrator has 
      visited the embedded Phorum once, he can login to admin.php too.

    - The syncuser script now also understands passwords prefixed with
      the string $MD5$. When this string is set, embed_phorum_syncuser()
      will store the password as an already encrypted MD5 password. This
      way it is possible to synchronize passwords that are stored only
      MD5 encrypted in the master application.

    - The syncuser.php script now keeps passwords for administrators intact,
      so they can login to Phorum's admin interface.

    - In the templates the [mod_embed_phorum <elementname] dividers are
      renamed to [element <elementname>] for clarity.

    - Moved creating the $PHORUM_CONNECTOR object to the glue code, so the
      glue code has ultimate freedom in setting up the connector object.

    - Finished method documentation of PhorumConnectorBase.php. 

    - The email settings panel in the control center will no longer spawn an
      error about the email address not being filled in, in case Phorum is
      not allowed to change the email address (in which case that field is
      not available in the control center).

    - The file.php script output was always printed in raw mode. Now,
      that is only done if a file really is downloaded (so error messages
      are displayed correctly).

0.0.3 2006-02-04

    - Renamed the connector method get_userid() to get_user_id() (so the
      name matches the user_id field).

    - Added a user synchronization script "syncuser.php". This script
      contains an easy function for synchronizing users with the Phorum
      database.

    - Extended connectors/gitaar.net/connector.php (the example connector,
      which I use for embedding Phorum in my own website) with on-the-fly
      user synchronization using the syncuser.php script. The user
      synchronization could also be done outside the connector, but this is
      the easiest way to do it. When the connector is run, you're already in
      the Phorum environment where you can use the Phorum database directly.

0.0.2 2006-02-04

    - The connector now has to implement a method get_slave_fields(), that
      has to return an array of fields that Phorum may edit through the
      user's control center. Both the front-end (though the templates) and
      the back-end (by filtering user fields before saving them) are aware
      of this array. So now you can configure what user fields will be
      synchronized from the master application and what fields the user can
      edit through the control center.

    - File downloading through file.php now works. Things went wrong,
      because file.php checks if the referring URL is at or below the
      Phorum's http_path setting. If off-site links are not allowed, now
      only the hostname in the http_path and the hostname in the referrer
      are compared.  That is good enough I think.

    - Output of both the file and RSS scripts is now handled correctly by
      phorum_block.php. The output of those scripts should not be processed,
      but should be sent directly to the browser. Before handling these pages,
      the phorum_block.php script calls ob_clean() to get rid of data that
      the master application already may have sent (for that to work, the
      master should have called ob_start() before starting its output of
      course).

    - Renamed some things:

      * template-dist => embed_phorum-template
      * phorum_block.php => run_phorum.php

    - Furthermore some small bugs and improvements are made.

0.0.1 2006-02-03

    - Preliminary proof-of-concept release 
